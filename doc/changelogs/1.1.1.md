# Changelog 1.1.1

## Follower Costume Bug Fix (Patch Release)

This patch release resolves a critical bug that was causing excessive error logging when follower outfits were updated.

---

## Bug Fixes

### Follower Costume NullReferenceException
- **Fixed**: Eliminated NullReferenceException spam in BepInEx logs
- **Root Cause**: Follower outfit changes weren't properly validating component existence
- **Impact**: Game's `Spine.Skin.AddSkin` was being called with null skin data during follower task transitions

### Methods Fixed

#### CultUtils.cs
- **SpawnFollower()** - Added comprehensive null checks for follower, brain, and outfit components
- **TurnFollowerYoung()** - Added null checks and safe outfit change handling
- **TurnFollowerOld()** - Added null checks and wrapped curse application in try-catch
- **GetFollowerFromInfo()** - Added null check with proper error handling
- **ConvertDissenting()** - Added null checks before accessing follower instance
- **MaximizeSatiationAndRemoveStarvation()** - Added null checks before removing cursed state
- **CureIllness()** - Added null checks before accessing follower instance

#### CultDefinitions.cs
- **GiveAllClothing()** - Completely rewritten with safe follower handling
  - Only updates FollowerInfo clothing data for followers not in scene
  - Safely updates actual Follower instance if they're loaded
  - Wrapped all outfit changes in try-catch blocks
  - Continues processing other followers if one fails

---

## Technical Details

### Problem
When spawning followers or changing their outfits, the mod was:
1. Setting `FollowerInfo.Outfit` and `FollowerInfo.Clothing` directly
2. Calling `Follower.SetOutfit()` without checking if follower/outfit components exist
3. Not handling cases where followers aren't loaded in the scene

This caused the game to throw `NullReferenceException` when followers transitioned tasks:
```
NullReferenceException: Object reference not set to an instance of an object
Stack trace:
Spine.Skin.AddSkin (Spine.Skin skin)
FollowerBrain.SetFollowerCostume (...)
Follower.SetOverrideOutfit (...)
FollowerTask_ResourceStation.Cleanup (...)
```

### Solution
1. **Null Checks**: Validate follower, brain, and outfit components before accessing
2. **Try-Catch Blocks**: Wrap all outfit changes to prevent crashes
3. **Graceful Degradation**: Continue operation if outfit update fails
4. **Better Logging**: Added `[CheatMenu]` prefix to all error messages
5. **Scene-Aware Updates**: Only update loaded followers' outfits, set data for unloaded ones

---

## Benefits

- **No More Log Spam** - NullReferenceException errors eliminated from BepInEx logs
- **Stable Operations** - Followers can transition between tasks without errors
- **Better Error Messages** - Clear debugging context with [CheatMenu] prefix
- **Graceful Failures** - Mod continues working even if some operations fail
- **Scene-Aware** - Properly handles followers that aren't currently loaded

---

## Upgrade Instructions

### From v1.1.0 to v1.1.1
Simply replace the `CheatMenu.dll` file in `BepInEx/plugins/CheatMenu/` with the new version. No configuration changes required.

### Compatibility
- ? Fully compatible with v1.1.0 save files
- ? No config file changes needed
- ? Drop-in replacement

---

## Files Changed
- `src/CultUtils.cs` - 8 methods updated with null checks and error handling
- `src/definitions/CultDefinitions.cs` - GiveAllClothing() rewritten

---

## Testing
- ? Build successful
- ? No NullReferenceException in logs
- ? Follower spawning works correctly
- ? Outfit changes apply safely
- ? Age manipulation doesn't cause errors
- ? Clothing assignment handles all edge cases

---

**This patch is recommended for all v1.1.0 users experiencing log spam issues.**
